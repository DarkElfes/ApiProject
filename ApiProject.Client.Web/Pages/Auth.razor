@page "/auth"
@using ApiProject.Client.Web.Users
@using ApiProject.Shared.Users

<PageTitle>Auth</PageTitle>

<MudStack>
    <MudText>Register</MudText>

    <MudTextField Placeholder="Username" @bind-Value="Username"/>
    <MudTextField Placeholder="Email" @bind-Value="Email" />
    <MudTextField Placeholder="Password" @bind-Value="Password" />

    <MudButton OnClick="RegisterAsync">Register</MudButton>
</MudStack>

@code{
    private string
        Username = string.Empty,
        Email = string.Empty,
        Password = string.Empty;

    [Inject] public required AuthStateProvider AuthProvider { get; set; }
    [Inject] public required NavigationManager Navigation { get; set; }
    [Inject] public required ISnackbar Snackbar { get; set; }

    async Task RegisterAsync(){
        var result = await AuthProvider.RegisterAsync(new(Username, Email, Password));

        if (result.IsSuccess)
            Navigation.NavigateTo("/profile");
        else
            Snackbar.Add(result.Errors.FirstOrDefault()?.ToString() ?? "Unhandled error", Severity.Error);
    }
}